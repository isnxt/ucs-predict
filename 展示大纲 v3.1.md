# 1. 数据预处理
## 1.1 字段命名冲突
查看所有数据表字段      
[图片]    
cate[product]与cate[shop]命名冲突，cate[shop]重命名为shop_cate[shop]    
[图片]    
## 1.2 填补空值[待定]
对日期列空值进行2018-4-16 00:00:00的填充    
[图片]    
对其他空值填充-1,(京东提供数据对未知也用-1填充，且xgboost可以针对空值进行训练)    
[图片]    
## 1.3 去除无效数据
分别对填充后的action/user/shop/product/comment表进行相同字段的比对     
(eg: sku_id[action,product] user_id[action,user])
去掉没有同时存在的记录，前后数据量对比，如下    
[图片]    
## 1.4 特征转换
### 1.4.1 时间特征转换
分别将user_reg_time/shop_reg_time/market_time[datetime64]与2018-4-16进行做差，转换为与2018-4-16距离的年/月/日[int]    
[图片]    

# 2. 数据分析
## 2.1 单个字段分析
某个字段+购买者某个字段+比例 hist图             
[图片]      
如果该字段比例hist图在1上下浮动较大，则认为与购买行为有一定关系
## 2.2 日行为分析
对浏览/购买/关注/评论/下单行为进行日计数统计，绘制日行为次数折线图，如下：    
[图片]    
发现2月购买行为异常[猜测可能是受春节影响]，去除2月action数据，并再次比对相同字段，去掉没有同时存在的记录，前后数据量对比如下，    
[图片]      
同时发现cart行为第一次出现时间是2018-4-8    

# 3. 特征工程
## 3.1 样本选择
### 3.1.1 用户品类选取
统计未来7天购买行为的[user,cate]在历史2/3/7/14/30天任意行为中出现的比例    
[图片]        
最终选取历史30天行为作为样本，详细划分如下表    
[表格]
### 3.1.2 用户品类商店选取
统计未来7天购买行为的[user,cate]在历史2/3/7/14/30天任意行为中出现的比例[以品类总量81做对比]              
[图片]       
统计未来7天购买行为的[user,cate,shop]在历史2/3/7/14/30天任意行为中出现的比例[以相同店铺主品类做对比]     
[图片]         
最终选取历史30天行为作为样本，详细划分如下表      
[表格]      
正负样本失衡解决措施：通过调整scale_pos_weight[xgboost]      
## 3.2 特征选取
我们根据上述数据分析，设计如下特征
用户：...    
品类：...        
店铺：...       
用户品类：...       
用户店铺：...         
用户品类店铺：...          
## 3.3 特征筛选          
每一个特征进行分析，如果len(feature.value_counts())不==1, 且正负样本分布不同，即为有效特征      
[图片]    
...
## 3.4 one-hot编码
由于采用xgboost模型，[引用模型原作者阐述]       
其树模型的本质，使得不需要对有序类别特征进行one-hot编码      
并且只可以对类别量1-100的无序类别特征进行One-hot编码，否则将会影响模型性能，

# 4. 模型
## 4.1 参数调优
由于scikit-learn gridsearchcv对于过大的数据量速度极慢，所以采用坐标下降的方法，按照影响程度从大到小进行每个参数的网格搜索，示例过程如下，    
最后得到的最优参数如下，    
[图片]
## 4.2 结果选取
统计历史7天用户购买品类的数值      
[图片]        
发现数值稳定在180000左右，          
复现京东算分函数，根据上述结果分别选取前range(10000,250000,10000)的行数作为提交结果，示例过程如下图     
[图片]       




